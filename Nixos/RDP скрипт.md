# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: RDP-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ `xfreerdp` —Å –≤—ã–±–æ—Ä–æ–º —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ `fuzzel`

## üìå –ß—Ç–æ —ç—Ç–æ?

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–¥–æ–±–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —É–¥–∞–ª—ë–Ω–Ω—ã–º —Ä–∞–±–æ—á–∏–º —Å—Ç–æ–ª–∞–º (RDP-—Å–µ—Ä–≤–µ—Ä–∞–º) —Å –ø–æ–º–æ—â—å—é —É—Ç–∏–ª–∏—Ç—ã `wlfreerdp` (FreeRDP –¥–ª—è Wayland), –∏—Å–ø–æ–ª—å–∑—É—è –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ –º–µ–Ω—é `fuzzel` ‚Äî –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π dmenu-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π –ª–∞—É–Ω—á–µ—Ä –¥–ª—è Wayland.

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö RDP-—Å–µ—Ä–≤–µ—Ä–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ —É—á—ë—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.
- –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –ø—Ä—è–º–æ –≤ —Å–∫—Ä–∏–ø—Ç–µ (—É–¥–æ–±–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏!).
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (—Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ, –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞, –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —Ç.–¥.).
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (`notify-send`).
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –∏–∑ –º–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–±–ª–∞–≥–æ–¥–∞—Ä—è `.desktop`-—Ñ–∞–π–ª—É).

---

## üõ†Ô∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

–°–∫—Ä–∏–ø—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç **—Ç–æ–ª—å–∫–æ –≤ —Å—Ä–µ–¥–µ Wayland** –∏ —Ç—Ä–µ–±—É–µ—Ç:

1. **`xfreerdp`** ‚Äî –∫–ª–∏–µ–Ω—Ç FreeRDP –¥–ª—è Wayland.
2. **`fuzzel`** ‚Äî –º–µ–Ω—é –≤—ã–±–æ—Ä–∞ (–∞–Ω–∞–ª–æ–≥ dmenu –¥–ª—è Wayland).
3. **`notify-send`** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏.

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ NixOS

–î–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é NixOS:

```nix
environment.systemPackages = with pkgs; [
  freerdp  # —Å–æ–¥–µ—Ä–∂–∏—Ç wlfreerdp
  fuzzel
  libnotify  # –¥–ª—è notify-send
];
```

–ò–ª–∏ –≤ Home Manager:

```nix
home.packages = with pkgs; [
  freerdp
  fuzzel
  libnotify
];
```

> üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `wlfreerdp` –¥–æ—Å—Ç—É–ø–µ–Ω –≤ PATH. –í NixOS –æ–Ω –æ–±—ã—á–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `/run/current-system/sw/bin/wlfreerdp`.

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç** –≤ —É–¥–æ–±–Ω–æ–µ –º–µ—Å—Ç–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä:
   ```bash
   mkdir -p ~/.local/bin
   nano ~/.local/bin/rdp-fuzzel.sh
   ```
   –í—Å—Ç–∞–≤—å—Ç–µ —Ç—É–¥–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∫—Ä–∏–ø—Ç–∞.

2. **–°–¥–µ–ª–∞–π—Ç–µ –µ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º**:
   ```bash
   chmod +x ~/.local/bin/rdp-fuzzel.sh
   ```

3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤** –≤ —Å–µ–∫—Ü–∏–∏ `SERVERS`:
   ```bash
   SERVERS=(
       "–ò–º—è|–•–æ—Å—Ç|–ü–æ—Ä—Ç|–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å|–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ|–ü–∞—Ä–æ–ª—å"
   )
   ```
   –ü—Ä–∏–º–µ—Ä:
   ```bash
   "–û—Ñ–∏—Å|rdp.office.local|3389|user|1920x1080|MySecretPass123"
   ```

   ‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –µ—Å–ª–∏ –ø–∞—Ä–æ–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–∏–º–≤–æ–ª—ã `|`, `"`, `\`, –∏—Ö –Ω—É–∂–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –∑–∞–∫–ª—é—á–∏—Ç—å –≤ –∫–∞–≤—ã—á–∫–∏, –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ:
   ```bash
   "Holding|...|\"71MCVqKh4|Wu\b;fB"
   ```

4. **(–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `.desktop`-—Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∏–∑ –º–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:

   –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ –∫–∞–∫ `~/.local/share/applications/rdp-fuzzel.desktop`:
```ini
   [Desktop Entry]
   Version=1.0
   Type=Application
   Name=RDP Connect (Fuzzel)
   Comment=–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ RDP —Å–µ—Ä–≤–µ—Ä–∞–º —á–µ—Ä–µ–∑ fuzzel
   Exec=/home/efremov/.local/bin/rdp-fuzzel.sh
   Icon=preferences-desktop-remote-desktop
   Terminal=false
   Categories=Network;RemoteAccess;
   StartupNotify=true
```

   –ó–∞–º–µ–Ω–∏—Ç–µ –ø—É—Ç—å –≤ `Exec` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç—É.

   –û–±–Ω–æ–≤–∏—Ç–µ –∫—ç—à –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π:
   ```bash
   update-desktop-database ~/.local/share/applications
   ```

---

## ‚ñ∂Ô∏è –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç** –æ–¥–Ω–∏–º –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤:
   - –ß–µ—Ä–µ–∑ —Ç–µ—Ä–º–∏–Ω–∞–ª: `~/.local/bin/rdp-fuzzel.sh`
   - –ß–µ—Ä–µ–∑ –º–µ–Ω—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `.desktop`-—Ñ–∞–π–ª)
   - –ß–µ—Ä–µ–∑ –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `Super + Space` ‚Üí –≤–≤–µ–¥–∏—Ç–µ "RDP")

2. **–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä** –≤ –ø–æ—è–≤–∏–≤—à–µ–º—Å—è –º–µ–Ω—é `fuzzel`.

3. –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ —É—á—ë—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

4. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –ø–æ—è–≤–∏—Ç—Å—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω `libnotify`).

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü–∞—Ä–æ–ª–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è **–≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ** –≤ —Å–∫—Ä–∏–ø—Ç–µ. –≠—Ç–æ —É–¥–æ–±–Ω–æ, –Ω–æ **–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ**!
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
  - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É:  
    ```bash
    chmod 600 ~/.local/bin/rdp-fuzzel.sh
    ```
  - –ù–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –Ω–∞ –æ–±—â–∏—Ö –∏–ª–∏ –Ω–µ–Ω–∞–¥—ë–∂–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö.
  - –í –±—É–¥—É—â–µ–º –º–æ–∂–Ω–æ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è —á–µ—Ä–µ–∑ `zenity` –∏–ª–∏ `wofi --password`, —á—Ç–æ–±—ã –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –≤ –∫–æ–¥–µ.

---

## üõ† –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

- –ó–∞–º–µ–Ω–∏—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –Ω–∞ –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–∏–∞–ª–æ–≥.
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –¥–æ–º–µ–Ω–æ–≤ (`/d:DOMAIN`).
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `wofi` –≤–º–µ—Å—Ç–æ `fuzzel` (–µ—Å–ª–∏ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç–µ).

---

‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –±—ã—Å—Ç—Ä–æ –∏ —É–¥–æ–±–Ω–æ –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ —Å–≤–æ–∏–º RDP-—Å–µ—Ä–≤–µ—Ä–∞–º –≤ —Å—Ä–µ–¥–µ Wayland.

```bash
#!/run/current-system/sw/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ RDP —á–µ—Ä–µ–∑ wlfreerdp —Å –≤—ã–±–æ—Ä–æ–º —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ fuzzel
# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –∫—Ä–µ–¥–∞–º–∏

set -euo pipefail

# ========================
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤
# ========================

# –ú–∞—Å—Å–∏–≤ —Å–µ—Ä–≤–µ—Ä–æ–≤: –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Äî –æ–¥–∏–Ω —Å–µ—Ä–≤–µ—Ä –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
# "–ò–º—è|–•–æ—Å—Ç|–ü–æ—Ä—Ç|–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å|–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ|–ü–∞—Ä–æ–ª—å"

SERVERS=(
	"–ò–º—è|–•–æ—Å—Ç|–ü–æ—Ä—Ç|–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å|–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ|–ü–∞—Ä–æ–ª—å"
)

# ========================
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
# ========================

if ! command -v wlfreerdp &>/dev/null; then
	echo "‚ùå wlfreerdp –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏ freerdp."
	echo "–í NixOS: –¥–æ–±–∞–≤—å 'freerdp' –≤ systemPackages –∏–ª–∏ home.packages"
	exit 1
fi

if ! command -v fuzzel &>/dev/null; then
	echo "‚ùå fuzzel –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏ fuzzel."
	echo "–í NixOS: –¥–æ–±–∞–≤—å 'fuzzel' –≤ systemPackages –∏–ª–∏ home.packages"
	exit 1
fi

# ========================
# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è fuzzel
# ========================

# –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª —Å –æ–ø—Ü–∏—è–º–∏ –¥–ª—è fuzzel
FUZZEL_OPTIONS=$(mktemp)

for i in "${!SERVERS[@]}"; do
	name=$(echo "${SERVERS[$i]}" | cut -d'|' -f1)
	host=$(echo "${SERVERS[$i]}" | cut -d'|' -f2)
	port=$(echo "${SERVERS[$i]}" | cut -d'|' -f3)
	user=$(echo "${SERVERS[$i]}" | cut -d'|' -f4)
	echo "$name|$host|$port|$user" >>"$FUZZEL_OPTIONS"
done

# ========================
# –í—ã–±–æ—Ä —á–µ—Ä–µ–∑ fuzzel
# ========================

SELECTED=$(fuzzel --dmenu --prompt="üåê –í—ã–±–µ—Ä–∏—Ç–µ RDP-—Å–µ—Ä–≤–µ—Ä: " <"$FUZZEL_OPTIONS")

# –û—á–∏—â–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
rm "$FUZZEL_OPTIONS"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞–ª —Å–µ—Ä–≤–µ—Ä
if [ -z "$SELECTED" ]; then
	echo "‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –≤—ã–±—Ä–∞–Ω"
	exit 1
fi

# ========================
# –ü–æ–∏—Å–∫ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
# ========================

SELECTED_SERVER=""
for server in "${SERVERS[@]}"; do
	name=$(echo "$server" | cut -d'|' -f1)
	if [[ "$SELECTED" == "$name"* ]]; then
		SELECTED_SERVER="$server"
		break
	fi
done

if [ -z "$SELECTED_SERVER" ]; then
	echo "‚ùå –í—ã–±—Ä–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω"
	exit 1
fi

# ========================
# –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞
# ========================

IFS='|' read -r NAME HOST PORT USER SIZE PASSWORD <<<"$SELECTED_SERVER"

# ========================
# –§–æ—Ä–º–∏—Ä—É–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã
# ========================

ARGS=(
	/v:"$HOST:$PORT"
	/u:"$USER"
	/size:"$SIZE"
	/clipboard
	/dynamic-resolution
	/cert:ignore
	+auto-reconnect
	-themes
	-wallpaper
	/auto-reconnect-max-retries:5
	/bpp:32
	/p:"$PASSWORD"
)

# ========================
# –ó–∞–ø—É—Å–∫
# ========================

echo "üöÄ –ü–æ–¥–∫–ª—é—á–∞—é—Å—å –∫: $NAME ($HOST:$PORT) –∫–∞–∫ $USER..."

# –ó–∞–ø—É—Å–∫–∞–µ–º –∏ –∂–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
xfreerdp "${ARGS[@]}"

# –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å notify-send)
if command -v notify-send &>/dev/null; then
	notify-send "RDP" "–°–µ—Å—Å–∏—è —Å $NAME –∑–∞–≤–µ—Ä—à–µ–Ω–∞" -u low
fi

echo "‚úÖ –°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞."

```nn